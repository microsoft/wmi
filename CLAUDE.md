# CLAUDE.md

> Project context for Claude sessions. Generated by `prime`.

## Quick Context

Go library (`github.com/microsoft/wmi`) providing Windows WMI bindings for managing Hyper-V virtualization, Windows Failover Clustering, and hardware resources. Uses COM/OLE via `go-ole` - Windows-only, requires admin privileges. Contains ~22,000 auto-generated WMI class wrappers for Server 2019 and Server 23H2.

## Context Docs

- [Architecture](.claude/context/architecture.md) - System design, components, data flow
- [Patterns](.claude/context/patterns.md) - Code patterns, conventions, error handling
- [Structure](.claude/context/structure.md) - Directory layout, key files
- [Usage](.claude/context/usage.md) - Building, testing, common usage
- [Tests](.claude/context/tests.md) - Test framework and organization

## Key Commands

```bash
# Build (Windows only)
make library

# Run tests
make test

# Format code
make format

# Tidy dependencies
make vendor
```

## Important Notes

- **Windows-only**: All code has `//go:build windows` constraint
- **Generated code**: `server2019/` and `server23h2/` contain ~22,000 auto-generated files from WMI MOF schemas
- **COM resources**: Always `defer instance.Close()` to release COM objects
- **Session pooling**: Sessions cached by namespace+server+domain
- **Admin required**: Most WMI operations need elevated privileges

## Common Namespaces

| Namespace | Purpose |
|-----------|---------|
| `root\virtualization\v2` | Hyper-V management |
| `root\cimv2` | Standard WMI classes |
| `root\MSCluster` | Failover Clustering |
| `root\microsoft\windows\cluster` | Modern cluster API |

## Code Locations

- **WMI core implementation**: `pkg/wmiinstance/`
- **Session management**: `pkg/base/session/`
- **Hyper-V APIs**: `pkg/virtualization/`
- **Cluster APIs**: `pkg/cluster/`
- **Generated classes**: `server2019/root/`, `server23h2/root/`
